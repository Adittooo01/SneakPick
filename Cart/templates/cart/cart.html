{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'cart/cart.css' %}">
</head>
<body>
    <div class="cart-container">
        <!-- Back to Homepage Button -->
        <button class="back-button" onclick="window.location.href='/'">Back to Homepage</button>

        <table class="cart-table" id="cart-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Render Cart Items Dynamically -->
                {% for item in cart.items %}
                <tr>
                    <td>{{ item.product_name }}</td>
                    <td>${{ item.price }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ item.total_price }}</td>
                    <td>

                        <button onclick="updateCart('{{ item.id }}', 'increase')">+</button>
                        <button onclick="updateCart('{{ item.id }}', 'decrease')">-</button>
                        <button onclick="removeFromCart('{{ item.id }}')">Remove</button>


                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Cart Total -->
        <div class="cart-total" id="cart-total">Total: ${{ cart.total }}</div>

        <!-- Apply Coupon Section -->
        <div class="apply-coupon">
            <input type="text" id="coupon-code" placeholder="Enter Coupon Code">
            <button onclick="applyCoupon()">Apply Coupon</button>
            <div id="coupon-message" style="color: #f00;"></div>
        </div>
        <!-- Proceed to Checkout Button -->
        <button class="proceed-button" id="checkout-button">Proceed to Checkout</button>
<script>
    // Redirect to checkout page on button click
    document.getElementById("checkout-button").addEventListener("click", function () {
        window.location.href = "{% url 'payment' %}";
    });
</script>

    </div>
</body>
</html>



<script>
function updateCart(itemId, action) {
    fetch("{% url 'cart:update_cart' %}", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: `item_id=${itemId}&action=${action}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();  // âœ… refresh to show updated cart
        } else {
            alert("Error: " + (data.error || "Something went wrong"));
        }
    });
}

function removeFromCart(itemId) {
    updateCart(itemId, "remove");
}
</script>