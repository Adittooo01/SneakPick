{% extends 'base_layout.html' %}

{% block title %}Search Products{% endblock %}

{% block content %}
    <header>
        <h1>Search Products</h1>
    </header>

    <main>
        <!-- Search Form -->
        <form method="get" action="" class="search-form">
            <input type="text" name="q" placeholder="Search for products..." value="{{ query }}">
            <button type="submit">Search</button>
        </form>

        <!-- Sort Form -->
        <form method="get" action="" class="sort-form">
            <input type="hidden" name="q" value="{{ query }}">
            
            <label for="sort_by">Sort by:</label>
            <select name="sort_by" id="sort_by">
                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Name</option>
                <option value="price" {% if sort_by == 'price' %}selected{% endif %}>Price</option>
                <option value="rating" {% if sort_by == 'rating' %}selected{% endif %}>Rating</option>
            </select>

            <label for="sort_order">Order:</label>
            <select name="sort_order" id="sort_order">
                <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Ascending</option>
                <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Descending</option>
            </select>

            <button type="submit">Sort</button>
        </form>

        <!-- Search Results -->
        <section class="search-results">
            {% if query %}
                <div class="bad-query">
                    {% if query|length < 2 %}
                        <p>Please enter at least 2 characters for the search.</p>
                    {% else %}
                        <p class="results-info">Showing results for "{{ query }}":</p>
                        {% if results %}
                            <div class="product-list">
                                {% for product in results %}
                                    <div class="product-card">
                                        <img src="{{ product.image.url }}" alt="{{ product.name }}">
                                        <h3>{{ product.name }}</h3>
                                        <p class="price">Price: ${{ product.price }}</p>
                                        <p class="rating">Rating: {{ product.rating }}/5.0</p>
                                        <form action="{% url 'products:product_detail' product.id %}" method="get">
                                            <button type="submit">View Product</button>
                                        </form>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="no-results">No products found. Please refine your search.</p>
                        {% endif %}
                    {% endif %}
                </div>
            {% else %}
                <p class="no-query">Please enter a search query.</p>
            {% endif %}
        </section>
    </main>
{% endblock %}
